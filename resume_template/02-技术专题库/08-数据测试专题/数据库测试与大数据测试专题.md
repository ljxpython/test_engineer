# 数据库测试与大数据测试专题

## 专题概述
本专题涵盖数据库测试、大数据测试、数据质量保障等核心知识点，适用于高级测试开发工程师岗位。

## 核心技能要求
- 数据库测试策略制定
- 大数据平台测试经验
- 数据质量监控体系
- ETL流程测试方法
- 数据一致性验证
- 分布式数据库测试

---

## 1. 数据库测试基础

### 1.1 数据库测试策略设计 ⭐⭐⭐ 🔥🔥🔥

**问题：** 设计一套完整的数据库测试策略，包括功能、性能、安全性测试。



**回答（口述版，STAR）**：
> 指标口径统一见 [metrics_glossary_and_sources.md](../../metrics_glossary_and_sources.md)
- 场景：核心业务数据库承载关键交易/用户数据，需在不扰动现网的前提下同时保障完整性/一致性/高可用。
- 任务：搭一套可度量、可复用、可回归的数据库测试策略（功能/性能/安全）。
- 行动：1) 功能：结构/约束/事务/并发/一致性；2) 性能：查询/并发/容量基线+门禁；3) 安全：注入/权限/审计/脱敏；4) 工具化：影子库回放+脱敏、幂等与断点续传、对账与采样；5) 监控预警+周复盘闭环。
- 结果：一致性问题↓，回放覆盖率↑，性能门禁通过率↑，生产数据事故↓，策略在多项目复用。

### 1.2 数据完整性验证 ⭐⭐⭐ 🔥🔥🔥

**问题：** 如何设计并实现数据完整性的自动化验证？

**回答（口述版，STAR）**：
> 指标口径统一见 [metrics_glossary_and_sources.md](../../metrics_glossary_and_sources.md)
- 场景：多源异构、脏数据多、链路长且存在增量/全量切换，批次窗口与延迟受限，错误回放代价高。
- 任务：建立“抽取→清洗→转换→加载”全链路可回归、可观测的ETL测试机制，在不扰动现网的前提下保障对账一致与窗口时延。
- 行动：1) 对账与采样比对（源↔ODS↔DWD↔DWS↔APP）；2) 脏数据与边界构造（空值/非法/极端/倾斜）；3) 断点续传与幂等（重跑不重算）；4) 增量/全量双路径与回放影子库；5) 性能容量与批次窗口门禁；6) 监控预警+工单闭环（异常聚合/去重/责任到人）。
- 结果：对账一致性≥99.9%，失败批次可回放，端到端窗口延迟≤阈值，生产数据事故显著下降，方案在多链路复用。
### 2.2 大数据平台测试 ⭐⭐⭐ 🔥🔥

**问题：** 针对Hadoop/Spark等大数据平台，如何设计性能和稳定性测试？

**回答（口述版，STAR）**：
> 指标口径统一见 [metrics_glossary_and_sources.md](../../metrics_glossary_and_sources.md)
- 场景：指标口径不一、误报多、响应慢，跨系统一致性与时效性难以统一衡量。
- 任务：围绕“完整/唯一/一致/及时/准确/有效”六维建立指标字典、阈值与预警闭环，保障持续监控与可追责。
- 行动：1) 指标字典与口径统一；2) 采集口径（埋点/SQL/日志/契约）与对账；3) 阈值分层（告警/错误）+SLA；4) 异常聚合与去重，责任路由到人；5) 看板与工单闭环；6) 回归基线、灰度校准与A/B；7) 与发布门禁联动。
- 结果：异常响应时间≈-40%，误报≈-30%，质量评分稳定≥阈值，可提前预警并拦截上线风险，方法可复用至多业务域。
## 4. 数据一致性测试

### 4.1 分布式数据一致性验证 ⭐⭐⭐ 🔥🔥

**问题：** 在分布式系统中，如何验证数据的最终一致性？

**回答（口述版，STAR）**：
> 指标口径统一见 [metrics_glossary_and_sources.md](../../metrics_glossary_and_sources.md)
- 场景：异地多活/分区容错场景下，延迟与一致性权衡，存在晚到/乱序与冲突合并风险。
- 任务：建立强/最终/因果一致性的可验证机制，量化复制延迟、收敛时间、冲突率，并将一致性门禁化。
- 行动：1) 设计：幂等键与去重表、事务边界与补偿流程、读写一致性策略（读你所写/单调读）；2) 验证：写放大与网络分区演练、对账与校验和比对、跨副本一致性抽样；3) 监测：复制延迟与收敛P95阈值、冲突率阈值、熔断与降级；4) 发布：灰度+回滚预案，混沌演练常态化。
- 结果：收敛时间P95≤5s，冲突自动解决率≥99%，回滚成功率≥95%，一致性相关事故显著下降，机制在多业务线复用。
---

## 5. 总结和最佳实践

### 5.1 数据测试最佳实践

1. **测试数据管理**
   - 建立测试数据生命周期管理
   - 实现测试数据的版本控制
   - 确保测试环境数据隐私合规

2. **自动化测试策略**
   - 数据质量检查自动化
   - 回归测试自动执行
   - 持续集成流水线集成

3. **监控告警体系**
   - 实时数据质量监控
   - 分级告警机制
   - 问题追踪和处理流程

4. **性能基准管理**
   - 建立性能基线
   - 定期性能回归测试
   - 容量规划和预测

### 5.2 技术栈建议

**数据库测试工具**
- pytest + SQLAlchemy (Python生态)
- DBUnit (Java生态)
- Great Expectations (数据质量)

**大数据测试工具**
- Apache Spark Testing Base
- TestContainers (容器化测试)
- Apache Beam Testing

**监控工具**
- Grafana + InfluxDB (指标监控)
- ELK Stack (日志分析)
- Apache Airflow (工作流调度)

本专题为数据测试提供了完整的知识体系和实践指南，帮助测试工程师掌握现代数据系统的测试方法。